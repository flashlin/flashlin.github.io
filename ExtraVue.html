<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>用ExtraVuex 寫TicTacToe 井字遊戲 | Flash&#39;s BLOG</title>
    <meta name="description" content="對於我這種只有一點點知識又沒錢的傢伙只好自行徒手建立這BLOG">
    
    
    <link rel="preload" href="/flashlin.github.io/assets/css/0.styles.7db30d77.css" as="style"><link rel="preload" href="/flashlin.github.io/assets/js/app.645328a8.js" as="script"><link rel="preload" href="/flashlin.github.io/assets/js/2.d3d2ff54.js" as="script"><link rel="preload" href="/flashlin.github.io/assets/js/10.5bae8f58.js" as="script"><link rel="prefetch" href="/flashlin.github.io/assets/js/11.10b8376f.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/12.808dbd33.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/13.19ef694c.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/14.81be9ba2.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/15.24c5cbc2.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/16.e68ac514.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/17.16836cfb.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/18.bd38b944.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/19.bd91999a.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/20.b4d0444b.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/21.41b3f76c.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/22.ccf74ed7.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/23.4f83a37f.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/24.f62eb2c7.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/25.464f035a.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/26.c17fcbb4.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/27.2a62172d.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/28.d81a01f9.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/29.813f4b57.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/3.773b18dc.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/30.8cad6a7e.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/31.208d6afd.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/32.b9c8bd3e.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/33.8c59acb6.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/34.4df75220.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/35.2dc7c7e7.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/36.07de1777.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/37.dd8ded36.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/38.1b977e55.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/39.cab869d4.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/4.92787893.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/5.47324f68.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/6.a5f35bf9.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/7.edccac52.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/8.ba319b0f.js"><link rel="prefetch" href="/flashlin.github.io/assets/js/9.8e08d824.js">
    <link rel="stylesheet" href="/flashlin.github.io/assets/css/0.styles.7db30d77.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/flashlin.github.io/" class="home-link router-link-active"><!----> <span class="site-name">Flash's BLOG</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/flashlin.github.io/" class="nav-link">Home</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/flashlin.github.io/" class="nav-link">Home</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Home</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/flashlin.github.io/" class="sidebar-link">ReadMe</a></li><li><a href="/flashlin.github.io/ARecent.html" class="sidebar-link">最近更新內容</a></li><li><a href="/flashlin.github.io/Build Failover Cluster.html" class="sidebar-link">Building a Two-Node Failover Cluster</a></li><li><a href="/flashlin.github.io/Docker.html" class="sidebar-link">Docker</a></li><li><a href="/flashlin.github.io/Docker-Linux.html" class="sidebar-link">Install Docker on Linux Mint 18</a></li><li><a href="/flashlin.github.io/DotNet-HttpModule.html" class="sidebar-link">DotNet HttpModule</a></li><li><a href="/flashlin.github.io/ElectronNET.html" class="sidebar-link">Electron.NET 入門</a></li><li><a href="/flashlin.github.io/ExtraVue.html" class="active sidebar-link">用ExtraVuex 寫TicTacToe 井字遊戲</a></li><li><a href="/flashlin.github.io/Git.html" class="sidebar-link">Git</a></li><li><a href="/flashlin.github.io/GoogleAnalyticsReport.html" class="sidebar-link">C# Google Analytics Report API</a></li><li><a href="/flashlin.github.io/Keras.html" class="sidebar-link">Keras</a></li><li><a href="/flashlin.github.io/Nginx-Rtmp-Server.html" class="sidebar-link">Nginx Rtmp Server</a></li><li><a href="/flashlin.github.io/OWASP TOP 10.html" class="sidebar-link">OWASP TOP 10</a></li><li><a href="/flashlin.github.io/Robocopy.html" class="sidebar-link">Robocopy 指令範例參考</a></li><li><a href="/flashlin.github.io/SQL-Joins.html" class="sidebar-link">SQL Joins Syntax</a></li><li><a href="/flashlin.github.io/Secutiry Misconfiguration.html" class="sidebar-link">OWASP-2013-A5 Security Misconfiguration (安全配置錯誤)</a></li><li><a href="/flashlin.github.io/SignalR.html" class="sidebar-link">SignalR</a></li><li><a href="/flashlin.github.io/TimescaleDB.html" class="sidebar-link">TimescaleDB</a></li><li><a href="/flashlin.github.io/VuePress-Tutorial.html" class="sidebar-link">VuePress + Github 取代 Gitbook or Blog</a></li><li><a href="/flashlin.github.io/Webpack.html" class="sidebar-link">WebPack</a></li><li><a href="/flashlin.github.io/Yarn.html" class="sidebar-link">Yarn</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DotNet-Core</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Typescripts</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>設計守則</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>錯誤集錦</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="用extravuex-寫tictactoe-井字遊戲"><a href="#用extravuex-寫tictactoe-井字遊戲" aria-hidden="true" class="header-anchor">#</a> 用ExtraVuex 寫TicTacToe 井字遊戲</h1> <p>2017/12/09</p> <img src="/flashlin.github.io/assets/img/Tic.f28e8d45.gif"> <p>趁此練習Typescript + Vue + Vuex, 首先開啟VS.NET 使用Nuget 下載</p> <ul><li>vue 2.3.4</li> <li>vue.TypeScript.DefinitelyTyped 0.1.1</li> <li>RequireJS 2.3.3</li> <li>requirejs.TypeScript.DefinitelyTyped 0.4.4</li></ul> <p>手動下載 3rd package</p> <ul><li>Vuex 2.3.0</li> <li>VueRouter 2.7.0</li> <li>t1</li> <li>ExtraVue</li></ul> <p>建立Index.cshtml 檔案, 並透過Requirejs 載入Boot.js</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;script src=&quot;~/Js/RequireConfig.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;~/Scripts/require.js&quot; data-main=&quot;/Js/Boot.js?v=@DateTime.Now.ToString(&quot;yyyyMMddHHmmss&quot;)&quot;&gt;&lt;/script&gt;

&lt;hr /&gt;
&lt;div id=&quot;app&quot;&gt;
&lt;/div&gt;
</code></pre></div><p>建立Boot.js 檔案</p> <div class="language- extra-class"><pre class="language-text"><code>define([&quot;require&quot;, &quot;exports&quot;, 'App'], function (require, exports, app) {
});
</code></pre></div><p>建立App.ts 開始撰寫Vue 應用程式</p> <div class="language- extra-class"><pre class="language-text"><code>import * as VueRouter from &quot;vue-router&quot;;
import * as Vue from &quot;vue&quot;;
import * as ExtraVue from &quot;ExtraVue&quot;;
import * as t1 from &quot;t1&quot;;

Vue.use(VueRouter);
</code></pre></div><p>接著準備設計Game HTML 畫面, 所以繼續在App.ts 加上下面樣板</p> <div class="language- extra-class"><pre class="language-text"><code>let appTemplate = `
&lt;div&gt;
	&lt;span&gt;井字遊戲&lt;/span&gt;
	&lt;br/&gt;
	&lt;button @click=&quot;startNewGame()&quot;&gt;開始新遊戲&lt;/button&gt;
	&lt;br /&gt;
	&lt;table class=&quot;table table-bordered TicTac&quot; style=&quot;width:100px&quot;&gt;
		&lt;tbody&gt;
			&lt;tr v-for=&quot;x in 3&quot;&gt;
				&lt;template v-for=&quot;y in 3&quot;&gt;
					&lt;td @click=&quot;clickPlaid(x-1,y-1)&quot;&gt;{{ ticMatrix[x-1][y-1] }}&lt;/td&gt;
				&lt;/template&gt;
			&lt;/tr&gt;
		&lt;/tbody&gt;
   &lt;/table&gt;
	&lt;span&gt;{{ $store.state.message }}&lt;/span&gt;
&lt;/div&gt;
`;
</code></pre></div><p>透過上述的v-for 迴圈指令, 可以簡化下面重複的HTML 碼</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;tbody&gt;
	&lt;tr&gt;
		&lt;td @click=&quot;clickPlaid(0,0)&quot;&gt;{{ ticMatrix[0][0] }}&lt;/td&gt;
		&lt;td @click=&quot;clickPlaid(0,1)&quot;&gt;{{ ticMatrix[0][1] }}&lt;/td&gt;
		&lt;td @click=&quot;clickPlaid(0,2)&quot;&gt;{{ ticMatrix[0][2] }}&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td @click=&quot;clickPlaid(1,0)&quot;&gt;{{ ticMatrix[1][0] }}&lt;/td&gt;
		&lt;td @click=&quot;clickPlaid(1,1)&quot;&gt;{{ ticMatrix[1][1] }}&lt;/td&gt;
		&lt;td @click=&quot;clickPlaid(1,2)&quot;&gt;{{ ticMatrix[1][2] }}&lt;/td&gt;
	&lt;/tr&gt;
	&lt;tr&gt;
		&lt;td @click=&quot;clickPlaid(2,0)&quot;&gt;{{ ticMatrix[2][0] }}&lt;/td&gt;
		&lt;td @click=&quot;clickPlaid(2,1)&quot;&gt;{{ ticMatrix[2][1] }}&lt;/td&gt;
		&lt;td @click=&quot;clickPlaid(2,2)&quot;&gt;{{ ticMatrix[2][2] }}&lt;/td&gt;
	&lt;/tr&gt;
&lt;/tbody&gt;
</code></pre></div><blockquote><p>注意Vue 1.0 的v-for=&quot;x in 3&quot; 是從0 開始, 而Vue 2.0以後則是從1 開始</p></blockquote> <p>為了讓HTML Table 大小固定, 就在Index.cshtml 中加上Style</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;style&gt;
	table.TicTac td {
		width: 40px;
		height: 40px;
		text-align: center;
	}
&lt;/style&gt;
</code></pre></div><p>開始準備Vuex 架構設計這個遊戲</p> <blockquote><p>Vuex 類似React 的 Reflux</p></blockquote> <p>下面是設計Vue Actions</p> <div class="language- extra-class"><pre class="language-text"><code>enum GameActionType {
	StartNewGame,
	ClickPlaid
}
</code></pre></div><p>接著建立Vuex App 原型, 準備數個@ExtraVue.VueMethod() 方法讓View 呼叫</p> <div class="language- extra-class"><pre class="language-text"><code>class MyApp extends ExtraVue.VueApp {

	constructor() {
		super();
	}

	getTemplate(): string {
		return appTemplate;
	}

	@ExtraVue.VueMethod()
	startNewGame() {
		this.action(GameActionType[GameActionType.StartNewGame]);
	}

	@ExtraVue.VueMethod()
	clickPlaid(x: number, y: number) {
		this.action(GameActionType[GameActionType.ClickPlaid], Pos(x, y));
	}
}
</code></pre></div><blockquote><p>在VueApp 中, 透過this.action() 方法發送到Store.</p></blockquote> <p>接著設計Vue State 原型</p> <div class="language- extra-class"><pre class="language-text"><code>class MyState {
	ticMatrix: Player[][] = createEmptyTicMatrix();
	message: string = &quot;&quot;;
	isGameOver: boolean = false;
}
</code></pre></div><blockquote><p>注意 Vue State 物件不可以有方法</p></blockquote> <p>接下來設計 Store 原型, 包含數個@ExtraVue.VuexActionMutation 專門接收action ,
最後要用commit 方法通知變更state.</p> <div class="language- extra-class"><pre class="language-text"><code>class MyVuexStore extends ExtraVue.VuexStore {
	constructor(initState: MyState) {
		super(initState);
	}

	@ExtraVue.VuexActionMutation(GameActionType[GameActionType.StartNewGame])
	startNewGame(commit) {
		commit((state: MyState) =&gt; {
			Object.assign(self._vueObj.state, new MyState());
		});
	}

	@ExtraVue.VuexActionMutation(GameActionType[GameActionType.ClickPlaid])
	clickPlaid(commit, args: Position) {
		commit((state: MyState) =&gt; {
		});
	}

}
</code></pre></div><blockquote><p>注意state 裡面的Array 變數如果要改變, 不可以直接用arr[index] = newValue 方式指定, 要用arr.splice(index, 1, newValue); 方式指定</p></blockquote> <p>在設計井字遊戲過程中, 遇到比較特別的是,
我們常常會需要類似C# Dictionary&lt;TKey,TValue&gt;</p> <p>在Javascript/Typescript 世界裡沒辦法像C# 優雅的語法寫成</p> <div class="language- extra-class"><pre class="language-text"><code>let PlaidDic = new Dictionary&lt;DrawType, string&gt;() {
	{ DrawType.None: &quot; &quot;},
	{ DrawType.Fork: &quot;X&quot;},
	{ DrawType.Circle: &quot;O&quot;},
};
</code></pre></div><p>雖然我們可以寫成下面方式</p> <div class="language- extra-class"><pre class="language-text"><code>const PlaidDicTuples: any[][] = [
	[DrawType.None, &quot; &quot;],
	[DrawType.Fork, &quot;X&quot;],
	[DrawType.Circle, &quot;O&quot;]
];

let PlaidDic = [];
PlaidDicTuples.forEach(item=&gt;{
	PlaidDic[item[0]] = item[1];
});

return PlaidDic[DrawType.Fork];
</code></pre></div><p>但這樣卻得使用any[][] 容易打錯字又醜陋, 但我們可以透過t1 簡化成</p> <div class="language- extra-class"><pre class="language-text"><code>const PlaidDic = t1.createDictionaryTable&lt;DrawType, string&gt;([
	[DrawType.None, &quot; &quot;],
	[DrawType.Fork, &quot;X&quot;],
	[DrawType.Circle, &quot;O&quot;]
]);

return PlaidDic[DrawType.Fork];
</code></pre></div><p>完整原始碼在此 <a href="./ExtraVue-Images/App.ts">App.ts</a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/flashlin.github.io/ElectronNET.html" class="prev">Electron.NET 入門</a></span> <span class="next"><a href="/flashlin.github.io/Git.html">Git</a>→
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/flashlin.github.io/assets/js/app.645328a8.js" defer></script><script src="/flashlin.github.io/assets/js/2.d3d2ff54.js" defer></script><script src="/flashlin.github.io/assets/js/10.5bae8f58.js" defer></script>
  </body>
</html>

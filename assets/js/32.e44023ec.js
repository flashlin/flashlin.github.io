(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{410:function(e,s,t){"use strict";t.r(s);var a=t(0),r=Object(a.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"signalr"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#signalr","aria-hidden":"true"}},[e._v("#")]),e._v(" SignalR")]),e._v(" "),t("h3",{attrs:{id:"sql-server-環境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sql-server-環境","aria-hidden":"true"}},[e._v("#")]),e._v(" SQL Server 環境")]),e._v(" "),t("blockquote",[t("p",[e._v("Install-Package Microsoft.AspNet.SignalR.SqlServer -Version 2.2.1")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('string sqlConnectionString = ConfigurationManager.ConnectionStrings["SignalRService"].ToString();\nGlobalHost.DependencyResolver.UseSqlServer(sqlConnectionString);\napp.MapSignalR(hubConfiguration);\n')])])]),t("p",[e._v("SignalR會自動幫我們建立3張資料表")]),e._v(" "),t("ul",[t("li",[e._v("SignalR.Message_0")]),e._v(" "),t("li",[e._v("SignalR.Message_0_Id")]),e._v(" "),t("li",[e._v("SignalR.Schema")])]),e._v(" "),t("h3",{attrs:{id:"redis-環境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#redis-環境","aria-hidden":"true"}},[e._v("#")]),e._v(" Redis 環境")]),e._v(" "),t("blockquote",[t("p",[e._v("Install-Package Microsoft.AspNet.SignalR.Redis")])]),e._v(" "),t("p",[e._v("得先裝幾個工具")]),e._v(" "),t("blockquote",[t("p",[e._v("yum -y install net-tools wget gcc tcl")])]),e._v(" "),t("p",[e._v("安裝完畢後...我們就開始下載壓縮檔吧!!")]),e._v(" "),t("blockquote",[t("p",[e._v("wget http://download.redis.io/releases/redis-3.0.7.tar.gz")])]),e._v(" "),t("p",[e._v("再來就是解壓縮了")]),e._v(" "),t("blockquote",[t("p",[e._v("tar xzf redis-3.0.7.tar.gz")])]),e._v(" "),t("p",[e._v("接著先進入Redis的目錄底下")]),e._v(" "),t("blockquote",[t("p",[e._v("cd redis-3.0.7")])]),e._v(" "),t("p",[e._v("編譯一下")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("> make\n> make install\n")])])]),t("p",[e._v("先來建立個相關的目錄")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("> mkdir /etc/redis\n> mkdir /var/redis\n")])])]),t("p",[e._v("建立完畢後，再來複製設定檔!!")]),e._v(" "),t("blockquote",[t("p",[e._v("cp ~/redis-3.0.7/redis.conf /etc/redis/redis_6379.conf")])]),e._v(" "),t("p",[e._v("複製完後我們來建立一下工作的目錄")]),e._v(" "),t("blockquote",[t("p",[e._v("mkdir /var/redis/6379")])]),e._v(" "),t("p",[e._v("再來我們進去文件裡修改一下設置")]),e._v(" "),t("blockquote",[t("p",[e._v("vi /etc/redis/redis_6379.conf")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("daemonize yes\npidfile /var/run/redis_6379.pid\nlogfile /var/log/redis_6379.log\ndir /var/redis/6379\n")])])]),t("p",[e._v("重新設定一下防火牆")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("firewall-cmd --permanent --add-port=6379/tcp\nfirewall-cmd --reload\n")])])]),t("p",[e._v("把redis設定為開機就啟始!!\n先進去")]),e._v(" "),t("blockquote",[t("p",[e._v("vi /lib/systemd/system/redis_6379.service")])]),e._v(" "),t("p",[e._v("接著照下設定")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("[Unit]\nDescription=Redis on port 6379\nAfter=network.target\n[Service]\nType=forking\nExecStart=/user/local/bin/redis-server /etc/redis/redis_6379.conf\nExecStop=/user/local/bin/redis-cli -p 6379 shutdown\n[Install]\nWantedBy=nulti-user.target\n")])])]),t("p",[e._v("再來我們註冊Redis的服務")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("> systemctl daemon-reload\n> systemctl enable redis_6379.service\n")])])]),t("p",[e._v("再來啟用他!!")]),e._v(" "),t("blockquote",[t("p",[e._v("systemctl start redis_6379.service")])]),e._v(" "),t("p",[e._v("再來ping一下看看有沒有成功!!")]),e._v(" "),t("blockquote",[t("p",[e._v("redis-cli ping")])]),e._v(" "),t("p",[e._v("到這裡我們終於安裝完Redis 了,\n需要的只是在....Startup.cs 裡面加上這短短的一行就結束了!!")]),e._v(" "),t("blockquote",[t("p",[e._v("GlobalHost.DependencyResolver.UseRedis(server, port, password, eventKey);")])]),e._v(" "),t("p",[e._v("開一下Redis查詢一下Log , 我們輸入下列來進入Redis")]),e._v(" "),t("blockquote",[t("p",[e._v("redis-cli -a password")])]),e._v(" "),t("p",[e._v("再來輸入下面指令來查詢eventKey 為Redis 的紀錄")]),e._v(" "),t("blockquote",[t("p",[e._v("SUBSCRIBE Redis")])]),e._v(" "),t("h3",{attrs:{id:"azure-環境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#azure-環境","aria-hidden":"true"}},[e._v("#")]),e._v(" Azure 環境")]),e._v(" "),t("blockquote",[t("p",[e._v("Install-Package Microsoft.AspNet.SignalR.ServiceBus")])]),e._v(" "),t("h2",{attrs:{id:"custom-signalr-host"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#custom-signalr-host","aria-hidden":"true"}},[e._v("#")]),e._v(" Custom SignalR Host")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("Install-Package Microsoft.AspNet.SignalR.SelfHost\nInstall-Package Microsoft.Owin.Cors\n")])])]),t("p",[e._v("接著我們在console 專案中把服務給on起來")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('static void Main(string[] args){\n\tstring url = "http://localhost:8080";\n\tusing(WebApp.Start(url)){\n\t\tConsole.WriteLine("Server running on {0}", url);\n\t\tConsole.ReadLine();\n\t}\n}\n')])])]),t("p",[e._v("Startup.cs")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("class Startup {\n\tpublic void Configuration(IappBuilder app){\n\t\tapp.UseCors(CorsOptions.AllowAll);\n\t\tapp.MapSignalR();\n\t}\n}\n")])])]),t("p",[e._v("MyHub.cs")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("public class MyHub : Hub {\n\tpublic void Send(string name,string message){\n\t\tClients.All.addMessage(name, message);\n\t}\n}\n")])])])])}),[],!1,null,null,null);s.default=r.exports}}]);
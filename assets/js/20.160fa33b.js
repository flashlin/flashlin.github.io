(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{380:function(a,t,e){"use strict";e.r(t);var r=e(0),n=Object(r.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"從資料庫自動產生-entity-framework-code-first-模型-models"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#從資料庫自動產生-entity-framework-code-first-模型-models","aria-hidden":"true"}},[a._v("#")]),a._v(" 從資料庫自動產生 Entity Framework Code First 模型(Models)")]),a._v(" "),e("p",[a._v("2019-11-03")]),a._v(" "),e("p",[a._v("新增一些nuget packages 到專案")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("> dotnet add package Microsoft.EntityFrameworkCore.SqlServer\n> dotnet add package Microsoft.EntityFrameworkCore.Design\n")])])]),e("p",[a._v("以下是查看 dotnet ef 有哪些參數可用資訊")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("dotnet ef -h\n")])])]),e("p",[a._v("下面是從資料庫生成EF 模型的命令說明")]),a._v(" "),e("blockquote",[e("p",[a._v("dotnet ef dbcontext scaffold "),e("em",[a._v("<ConnectionString>")]),a._v(" "),e("em",[a._v("<Provider>")]),a._v(" -OutputDir "),e("em",[a._v("<DirectoryName>")])])]),a._v(" "),e("p",[a._v("同等以下指令")]),a._v(" "),e("blockquote",[e("p",[a._v("Scaffold-DbContext "),e("em",[a._v("<ConnectionString>")]),a._v(" "),e("em",[a._v("<Provider>")]),a._v(" -OutputDir "),e("em",[a._v("<DirectoryName>")])])]),a._v(" "),e("p",[a._v("以下是我用來從資料庫生成模型的示範命令")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('Scaffold-DbContext "Server=xxx;Database=Demo;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models\n')])])]),e("p",[a._v("它將生成Entities 和DbContext 原始碼.")]),a._v(" "),e("p",[a._v("讓我們看一下產生出來的原始碼, 所有模型均使用FluentAPI 配置, 這是默認選項. 但是如果您想使用DataAnnotation 屬性來配置模型, 那麼我們需要在如下命令中傳遞 -DataAnnotations 參數.")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('Scaffold-DbContext "Server=xxx;Database=Demo;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -OutputDir Models -UseDatabaseNames -force -DataAnnotations\n')])])]),e("blockquote",[e("p",[a._v("您可以使用 -d 或 -data-annotations 開關")])]),a._v(" "),e("p",[a._v("現在您可以看到修改後的Entities 原始碼內容.")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("namespace AspNetCore2Application.Models  \n{  \n    public partial class Employee\n    {  \n        public int Id { get; set; }  \n        [Required]  \n        [StringLength(100)]  \n        public string Name { get; set; }  \n\n        [Required]  \n        [StringLength(100)]  \n        public string Designation { get; set; }  \n        public int? Salary { get; set; }  \n    }  \n}\n")])])]),e("p",[a._v("如果要在更改資料庫架構後重新構建模型, 可以通過指定-force 選項來完成, 例如")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('dotnet ef dbcontext scaffold "Server=.\\;Database=xxx;Trusted_Connection=True;" Microsoft.EntityFrameworkCore.SqlServer -force\n')])])]),e("p",[a._v("建立模型後, 建議您使用 Migrations(遷移) 使資料庫與模型的任何更改保持同步.")]),a._v(" "),e("h2",{attrs:{id:"新增-migration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#新增-migration","aria-hidden":"true"}},[a._v("#")]),a._v(" 新增 Migration")]),a._v(" "),e("p",[a._v("以下是 command 視窗 migrations 命令")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("dotnet ef migrations add <name of migration>\n")])])]),e("p",[a._v("或者你也能在package manager 控制台中, 也有同樣的效果")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("add-migration <name of migration>\n")])])]),e("h2",{attrs:{id:"移除-migration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#移除-migration","aria-hidden":"true"}},[a._v("#")]),a._v(" 移除 Migration")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[command]> dotnet ef migrations remove\n[package manager console]> remove-migration\n")])])]),e("h2",{attrs:{id:"套用-migration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#套用-migration","aria-hidden":"true"}},[a._v("#")]),a._v(" 套用 Migration")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[Command line]> dotnet ef database update\n[Package Manager Console]> update-database\n")])])]),e("h2",{attrs:{id:"還原-migration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#還原-migration","aria-hidden":"true"}},[a._v("#")]),a._v(" 還原 Migration")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[Command line]> dotnet ef database update Create\n[Package Manager Console]> update-database Create\n")])])]),e("h2",{attrs:{id:"將-migration-套用於資料庫"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#將-migration-套用於資料庫","aria-hidden":"true"}},[a._v("#")]),a._v(" 將 Migration 套用於資料庫")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("[Command Line]> dotnet ef migrations script\n[Package Manager Console]> script-migration\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);
(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{205:function(t,e,a){t.exports=a.p+"assets/img/Tic.f28e8d45.gif"},391:function(t,e,a){"use strict";a.r(e);var n=a(0),i=Object(n.a)({},(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"用extravuex-寫tictactoe-井字遊戲"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用extravuex-寫tictactoe-井字遊戲","aria-hidden":"true"}},[t._v("#")]),t._v(" 用ExtraVuex 寫TicTacToe 井字遊戲")]),t._v(" "),n("p",[t._v("2017/12/09")]),t._v(" "),n("img",{attrs:{src:a(205)}}),t._v(" "),n("p",[t._v("趁此練習Typescript + Vue + Vuex, 首先開啟VS.NET 使用Nuget 下載")]),t._v(" "),n("ul",[n("li",[t._v("vue 2.3.4")]),t._v(" "),n("li",[t._v("vue.TypeScript.DefinitelyTyped 0.1.1")]),t._v(" "),n("li",[t._v("RequireJS 2.3.3")]),t._v(" "),n("li",[t._v("requirejs.TypeScript.DefinitelyTyped 0.4.4")])]),t._v(" "),n("p",[t._v("手動下載 3rd package")]),t._v(" "),n("ul",[n("li",[t._v("Vuex 2.3.0")]),t._v(" "),n("li",[t._v("VueRouter 2.7.0")]),t._v(" "),n("li",[t._v("t1")]),t._v(" "),n("li",[t._v("ExtraVue")])]),t._v(" "),n("p",[t._v("建立Index.cshtml 檔案, 並透過Requirejs 載入Boot.js")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<script src="~/Js/RequireConfig.js"><\/script>\n<script src="~/Scripts/require.js" data-main="/Js/Boot.js?v=@DateTime.Now.ToString("yyyyMMddHHmmss")"><\/script>\n\n<hr />\n<div id="app">\n</div>\n')])])]),n("p",[t._v("建立Boot.js 檔案")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('define(["require", "exports", \'App\'], function (require, exports, app) {\n});\n')])])]),n("p",[t._v("建立App.ts 開始撰寫Vue 應用程式")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('import * as VueRouter from "vue-router";\nimport * as Vue from "vue";\nimport * as ExtraVue from "ExtraVue";\nimport * as t1 from "t1";\n\nVue.use(VueRouter);\n')])])]),n("p",[t._v("接著準備設計Game HTML 畫面, 所以繼續在App.ts 加上下面樣板")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('let appTemplate = `\n<div>\n\t<span>井字遊戲</span>\n\t<br/>\n\t<button @click="startNewGame()">開始新遊戲</button>\n\t<br />\n\t<table class="table table-bordered TicTac" style="width:100px">\n\t\t<tbody>\n\t\t\t<tr v-for="x in 3">\n\t\t\t\t<template v-for="y in 3">\n\t\t\t\t\t<td @click="clickPlaid(x-1,y-1)">{{ ticMatrix[x-1][y-1] }}</td>\n\t\t\t\t</template>\n\t\t\t</tr>\n\t\t</tbody>\n   </table>\n\t<span>{{ $store.state.message }}</span>\n</div>\n`;\n')])])]),n("p",[t._v("透過上述的v-for 迴圈指令, 可以簡化下面重複的HTML 碼")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('<tbody>\n\t<tr>\n\t\t<td @click="clickPlaid(0,0)">{{ ticMatrix[0][0] }}</td>\n\t\t<td @click="clickPlaid(0,1)">{{ ticMatrix[0][1] }}</td>\n\t\t<td @click="clickPlaid(0,2)">{{ ticMatrix[0][2] }}</td>\n\t</tr>\n\t<tr>\n\t\t<td @click="clickPlaid(1,0)">{{ ticMatrix[1][0] }}</td>\n\t\t<td @click="clickPlaid(1,1)">{{ ticMatrix[1][1] }}</td>\n\t\t<td @click="clickPlaid(1,2)">{{ ticMatrix[1][2] }}</td>\n\t</tr>\n\t<tr>\n\t\t<td @click="clickPlaid(2,0)">{{ ticMatrix[2][0] }}</td>\n\t\t<td @click="clickPlaid(2,1)">{{ ticMatrix[2][1] }}</td>\n\t\t<td @click="clickPlaid(2,2)">{{ ticMatrix[2][2] }}</td>\n\t</tr>\n</tbody>\n')])])]),n("blockquote",[n("p",[t._v('注意Vue 1.0 的v-for="x in 3" 是從0 開始, 而Vue 2.0以後則是從1 開始')])]),t._v(" "),n("p",[t._v("為了讓HTML Table 大小固定, 就在Index.cshtml 中加上Style")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("<style>\n\ttable.TicTac td {\n\t\twidth: 40px;\n\t\theight: 40px;\n\t\ttext-align: center;\n\t}\n</style>\n")])])]),n("p",[t._v("開始準備Vuex 架構設計這個遊戲")]),t._v(" "),n("blockquote",[n("p",[t._v("Vuex 類似React 的 Reflux")])]),t._v(" "),n("p",[t._v("下面是設計Vue Actions")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("enum GameActionType {\n\tStartNewGame,\n\tClickPlaid\n}\n")])])]),n("p",[t._v("接著建立Vuex App 原型, 準備數個@ExtraVue.VueMethod() 方法讓View 呼叫")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("class MyApp extends ExtraVue.VueApp {\n\n\tconstructor() {\n\t\tsuper();\n\t}\n\n\tgetTemplate(): string {\n\t\treturn appTemplate;\n\t}\n\n\t@ExtraVue.VueMethod()\n\tstartNewGame() {\n\t\tthis.action(GameActionType[GameActionType.StartNewGame]);\n\t}\n\n\t@ExtraVue.VueMethod()\n\tclickPlaid(x: number, y: number) {\n\t\tthis.action(GameActionType[GameActionType.ClickPlaid], Pos(x, y));\n\t}\n}\n")])])]),n("blockquote",[n("p",[t._v("在VueApp 中, 透過this.action() 方法發送到Store.")])]),t._v(" "),n("p",[t._v("接著設計Vue State 原型")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('class MyState {\n\tticMatrix: Player[][] = createEmptyTicMatrix();\n\tmessage: string = "";\n\tisGameOver: boolean = false;\n}\n')])])]),n("blockquote",[n("p",[t._v("注意 Vue State 物件不可以有方法")])]),t._v(" "),n("p",[t._v("接下來設計 Store 原型, 包含數個@ExtraVue.VuexActionMutation 專門接收action ,\n最後要用commit 方法通知變更state.")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("class MyVuexStore extends ExtraVue.VuexStore {\n\tconstructor(initState: MyState) {\n\t\tsuper(initState);\n\t}\n\n\t@ExtraVue.VuexActionMutation(GameActionType[GameActionType.StartNewGame])\n\tstartNewGame(commit) {\n\t\tcommit((state: MyState) => {\n\t\t\tObject.assign(self._vueObj.state, new MyState());\n\t\t});\n\t}\n\n\t@ExtraVue.VuexActionMutation(GameActionType[GameActionType.ClickPlaid])\n\tclickPlaid(commit, args: Position) {\n\t\tcommit((state: MyState) => {\n\t\t});\n\t}\n\n}\n")])])]),n("blockquote",[n("p",[t._v("注意state 裡面的Array 變數如果要改變, 不可以直接用arr[index] = newValue 方式指定, 要用arr.splice(index, 1, newValue); 方式指定")])]),t._v(" "),n("p",[t._v("在設計井字遊戲過程中, 遇到比較特別的是,\n我們常常會需要類似C# Dictionary<TKey,TValue>")]),t._v(" "),n("p",[t._v("在Javascript/Typescript 世界裡沒辦法像C# 優雅的語法寫成")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('let PlaidDic = new Dictionary<DrawType, string>() {\n\t{ DrawType.None: " "},\n\t{ DrawType.Fork: "X"},\n\t{ DrawType.Circle: "O"},\n};\n')])])]),n("p",[t._v("雖然我們可以寫成下面方式")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('const PlaidDicTuples: any[][] = [\n\t[DrawType.None, " "],\n\t[DrawType.Fork, "X"],\n\t[DrawType.Circle, "O"]\n];\n\nlet PlaidDic = [];\nPlaidDicTuples.forEach(item=>{\n\tPlaidDic[item[0]] = item[1];\n});\n\nreturn PlaidDic[DrawType.Fork];\n')])])]),n("p",[t._v("但這樣卻得使用any[][] 容易打錯字又醜陋, 但我們可以透過t1 簡化成")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('const PlaidDic = t1.createDictionaryTable<DrawType, string>([\n\t[DrawType.None, " "],\n\t[DrawType.Fork, "X"],\n\t[DrawType.Circle, "O"]\n]);\n\nreturn PlaidDic[DrawType.Fork];\n')])])]),n("p",[t._v("完整原始碼在此 "),n("a",{attrs:{href:"./ExtraVue-Images/App.ts"}},[t._v("App.ts")])])])}),[],!1,null,null,null);e.default=i.exports}}]);